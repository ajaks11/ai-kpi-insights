<!DOCTYPE html>
<html>
<head>
    <title>AI KPI Insights Dashboard</title>
    <style>
        body {
            font-family: Arial;
            margin: 40px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        h1 {
            color: #333;
        }
        pre {
            background: #eee;
            padding: 15px;
            border-radius: 6px;
        }
    </style>
</head>
<body>

<h1>AI KPI Insights Dashboard</h1>

<div class="card">
    <h2>Top Active Users</h2>
    <canvas id="userChart" width="600" height="300"></canvas>
</div>

<div class="card">
    <h2>AI Insight</h2>
    <pre id="ai">Loading...</pre>
</div>

<div class="card">
    <h2>Top Active Users</h2>
    <pre id="users">Loading...</pre>
</div>

<script>
    // KPIs
    fetch("http://127.0.0.1:5000/kpis")
        .then(res => res.json())
        .then(data => {
            document.getElementById("kpis").textContent =
                JSON.stringify(data, null, 2);
        });

    // AI Insight
    fetch("http://127.0.0.1:5000/ai-insight")
        .then(res => res.json())
        .then(data => {
            document.getElementById("ai").textContent = data.insight;
        });

    // Top users chart
    fetch("http://127.0.0.1:5000/top-users")
        .then(res => res.json())
        .then(data => {
            const canvas = document.getElementById("userChart");
            const ctx = canvas.getContext("2d");

            const labels = data.map(item => item[0]);
            const values = data.map(item => item[1]);

            const maxValue = Math.max(...values);
            const barWidth = 40;
            const gap = 30;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            values.forEach((value, index) => {
                const barHeight = (value / maxValue) * 200;
                const x = index * (barWidth + gap) + 50;
                const y = canvas.height - barHeight - 30;

                ctx.fillStyle = "#4CAF50";
                ctx.fillRect(x, y, barWidth, barHeight);

                ctx.fillStyle = "#000";
                ctx.fillText(labels[index], x, canvas.height - 10);
                ctx.fillText(value, x, y - 5);
            });
        });
</script>


</body>
</html>
